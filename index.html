<html>
  <head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
    <script src="./messagepipe.js"></script>
  </head>
  <body>
    <div id="app" class="container">
      <h1>Cutting Management removal list MOCKUP</h1>
      <form>
        <div v-for="(item, index) in removalList" class="row mb-3" style="border-bottom: 1px solid gray;">
          <div class="form-group col-6">
            <label>rawSapMaterial</label>
            <input type="text" class="form-control" v-model="item.rawSapMaterial">
          </div>
          <div class="form-group col-6">
            <label>lamWoodModuleLength</label>
            <input type="text" class="form-control" v-model="item.lamWoodModuleLength">
          </div>
          <div class="form-group col-12">
            <button class="btn btn-secondary" @click.prevent="remove(index)">- Remove</button>
          </div>
        </div>
        <button class="btn btn-primary" @click.prevent="add">+ Add item</button>
        <button class="btn btn-primary" @click.prevent="save">Save</button>
        <button class="btn btn-secondary" @click.prevent="reset">Reset</button>
        <button class="btn btn-secondary" @click.prevent="cancel">Cancel</button>
      </form>
    </div>
    <script>
      (function() {
        var pipe = new MessagePipe(window.parent, 'http://localhost:61493');
        pipe.onConnected = function(data) {
          console.log('MOCKUP: pipe connected!');
        };      
        pipe.onReceived = function(data) {
          console.log('GitHub: recevied', data);
        };
        pipe.connect();

        new Vue({
          el: '#app',
          data: {
            removalList: [
              {
                "rawSapMaterial": "test1",
                "lamWoodModuleLength": "test2"
              }
            ]
          },
          methods: {
            remove: function(itemIndex) {
              this.removalList.splice(itemIndex, 1);
            },
            add: function() {
              this.removalList.push({
                "rawSapMaterial": "",
                "lamWoodModuleLength": ""
              });
            },          
            save: function() {
              pipe.send({
                method: "setRemovalList",
                params: {
                    removalList: this.removalList
                }
              })
            },
            reset: function() {
              this.removalList = []
            },
            cancel: function () {
              pipe.send({
                method: "terminate"
              });
            }
          }
        })
      })()
    </script>
  </body>
</html>